<% content_for :title, "My Profile" %>

<div class="max-w-5xl mx-auto space-y-8">
  <div class="overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-gray-100">
    <div class="border-b border-gray-100 px-6 py-6">
      <h1 class="text-3xl font-semibold text-gray-900">Account Details</h1>
    </div>
    <div class="px-6 py-6 space-y-6">
      <% if @user.errors[:phone_number].any? %>
        <div class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
          <%= @user.errors[:phone_number].to_sentence %>
        </div>
      <% end %>

      <dl class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-gray-500">Email</dt>
          <dd class="mt-2 text-base text-gray-900 break-words"><%= @user.email_address %></dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-gray-500">Username</dt>
          <dd class="mt-2 text-base text-gray-900"><%= @user.username %></dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-gray-500">Member since</dt>
          <dd class="mt-2 text-base text-gray-900"><%= @user.created_at.strftime("%B %d, %Y") %></dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-gray-500">Listings posted</dt>
          <dd class="mt-2 text-base text-gray-900"><%= @listing_count %></dd>
        </div>
        <div class="sm:col-span-2">
          <dt class="text-xs font-semibold uppercase tracking-wide text-gray-500">Phone number</dt>
          <dd class="mt-2 text-base text-gray-900">
            <%= @user.phone_number.presence || content_tag(:span, "Not added yet", class: "text-gray-400") %>
          </dd>
        </div>
      </dl>

      <div class="rounded-2xl border border-gray-200 bg-gray-50 px-5 py-6">
        <h2 class="text-lg font-semibold text-gray-900">Update phone number</h2>
        <%= form_with model: @user, url: profile_path, method: :patch, local: true, class: "mt-4" do |form| %>
          <div class="w-full sm:max-w-xl">
            <%= form.label :phone_number, class: "block text-sm font-medium text-gray-700" %>
            <div class="mt-2 flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4">
              <%= form.telephone_field :phone_number,
                                       value: @user.phone_number,
                                       placeholder: "e.g. 8475550101",
                                       class: "block w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-base text-gray-900 placeholder-gray-400 shadow-sm transition focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 sm:max-w-xs" %>
              <%= form.button (@user.phone_number.present? ? "Save phone number" : "Add phone number"),
                             type: "submit",
                             class: "inline-flex items-center justify-center whitespace-nowrap rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1" %>
            </div>
            <p class="mt-2 text-xs text-gray-500">Optional. Use digits only; add +country code if outside the U.S.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
