<div class="mt-6 w-full rounded-xl border border-gray-200 bg-white/80 p-5 shadow-sm">
  <div>
    <p class="text-xs font-semibold uppercase tracking-wide text-indigo-600">Offers</p>
    <h2 class="text-lg font-semibold text-gray-900">Make an offer</h2>
    <p class="text-sm text-gray-500">Send a bid and the seller will respond via email.</p>
  </div>

  <% if existing_bid %>
    <% border_class, badge_class = case existing_bid.status.to_sym
       when :accepted
         [ "border-green-100", "bg-green-100 text-green-800" ]
       when :rejected
         [ "border-red-100", "bg-red-100 text-red-800" ]
       when :countered
         [ "border-blue-100", "bg-blue-100 text-blue-800" ]
       else
         [ "border-yellow-100", "bg-yellow-100 text-yellow-800" ]
       end %>
    <div class="mt-4 rounded-lg border <%= border_class %> bg-gray-50 p-3 text-sm text-gray-700">
      <div class="flex items-center justify-between">
        <p class="font-semibold text-gray-800">Your latest offer</p>
        <span class="rounded-full px-2 py-1 text-xs font-semibold <%= badge_class %>"><%= existing_bid.status.humanize %></span>
      </div>
      <p class="mt-1 text-gray-600"><%= number_to_currency(existing_bid.amount) %></p>
      <% if existing_bid.countered? && existing_bid.response_amount.present? %>
        <p>Seller countered at <%= number_to_currency(existing_bid.response_amount) %>.</p>
      <% end %>
      <% if existing_bid.response_message.present? %>
        <p class="mt-1 italic text-gray-500">&ldquo;<%= existing_bid.response_message %>&rdquo;</p>
      <% end %>
    </div>
  <% end %>

  <%= form_with url: listing_bids_path(listing), scope: :bid, local: true, html: { class: "mt-4 space-y-4" } do |form| %>
    <div>
      <%= form.label :amount, "Your offer", class: "block text-xs font-semibold text-gray-600 uppercase tracking-wide" %>
      <%= form.number_field :amount,
                            step: 0.01,
                            min: 0,
                            required: true,
                            value: (existing_bid&.amount || listing.price),
                            class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
    </div>

    <div>
      <%= form.label :message, "Message (optional)", class: "block text-xs font-semibold text-gray-600 uppercase tracking-wide" %>
      <%= form.text_area :message,
                         rows: 3,
                         placeholder: "Share pickup timing, bundle ideas, etc.",
                         class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
    </div>

    <%= form.submit "Send offer",
                    class: "inline-flex w-full justify-center rounded-lg bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 focus-visible:ring-offset-2" %>
  <% end %>
</div>
